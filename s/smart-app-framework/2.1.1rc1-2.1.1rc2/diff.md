# Comparing `tmp/smart_app_framework-2.1.1rc1-py3-none-any.whl.zip` & `tmp/smart_app_framework-2.1.1rc2-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,8 +1,8 @@
-Zip file size: 306604 bytes, number of entries: 334
+Zip file size: 306713 bytes, number of entries: 334
 -rw-r--r--  2.0 unx      113 b- defN 80-Jan-01 00:00 core/__init__.py
 -rw-r--r--  2.0 unx        0 b- defN 80-Jan-01 00:00 core/basic_models/__init__.py
 -rw-r--r--  2.0 unx        0 b- defN 80-Jan-01 00:00 core/basic_models/actions/__init__.py
 -rw-r--r--  2.0 unx    10756 b- defN 80-Jan-01 00:00 core/basic_models/actions/basic_actions.py
 -rw-r--r--  2.0 unx     6265 b- defN 80-Jan-01 00:00 core/basic_models/actions/client_profile_actions.py
 -rw-r--r--  2.0 unx     1203 b- defN 80-Jan-01 00:00 core/basic_models/actions/command.py
 -rw-r--r--  2.0 unx     3083 b- defN 80-Jan-01 00:00 core/basic_models/actions/counter_actions.py
@@ -62,15 +62,15 @@
 -rw-r--r--  2.0 unx      568 b- defN 80-Jan-01 00:00 core/logging/logger_constants.py
 -rw-r--r--  2.0 unx      937 b- defN 80-Jan-01 00:00 core/logging/logger_formatter.py
 -rw-r--r--  2.0 unx      386 b- defN 80-Jan-01 00:00 core/logging/logger_handlers.py
 -rw-r--r--  2.0 unx     5264 b- defN 80-Jan-01 00:00 core/logging/logger_utils.py
 -rw-r--r--  2.0 unx        0 b- defN 80-Jan-01 00:00 core/message/__init__.py
 -rw-r--r--  2.0 unx      765 b- defN 80-Jan-01 00:00 core/message/app_info.py
 -rw-r--r--  2.0 unx     1370 b- defN 80-Jan-01 00:00 core/message/device.py
--rw-r--r--  2.0 unx     9260 b- defN 80-Jan-01 00:00 core/message/from_message.py
+-rw-r--r--  2.0 unx     9237 b- defN 80-Jan-01 00:00 core/message/from_message.py
 -rw-r--r--  2.0 unx      120 b- defN 80-Jan-01 00:00 core/message/message_constants.py
 -rw-r--r--  2.0 unx      179 b- defN 80-Jan-01 00:00 core/message/msg_validator.py
 -rw-r--r--  2.0 unx        0 b- defN 80-Jan-01 00:00 core/model/__init__.py
 -rw-r--r--  2.0 unx     3159 b- defN 80-Jan-01 00:00 core/model/base_user.py
 -rw-r--r--  2.0 unx     2817 b- defN 80-Jan-01 00:00 core/model/factory.py
 -rw-r--r--  2.0 unx      209 b- defN 80-Jan-01 00:00 core/model/field.py
 -rw-r--r--  2.0 unx        0 b- defN 80-Jan-01 00:00 core/model/heapq/__init__.py
@@ -145,31 +145,31 @@
 -rw-r--r--  2.0 unx      359 b- defN 80-Jan-01 00:00 scenarios/behaviors/behavior_descriptions.py
 -rw-r--r--  2.0 unx    15834 b- defN 80-Jan-01 00:00 scenarios/behaviors/behaviors.py
 -rw-r--r--  2.0 unx        0 b- defN 80-Jan-01 00:00 scenarios/logging/__init__.py
 -rw-r--r--  2.0 unx     4248 b- defN 80-Jan-01 00:00 scenarios/logging/logger_constants.py
 -rw-r--r--  2.0 unx        0 b- defN 80-Jan-01 00:00 scenarios/requirements/__init__.py
 -rw-r--r--  2.0 unx     2799 b- defN 80-Jan-01 00:00 scenarios/requirements/requirements.py
 -rw-r--r--  2.0 unx        0 b- defN 80-Jan-01 00:00 scenarios/scenario_descriptions/__init__.py
--rw-r--r--  2.0 unx    10695 b- defN 80-Jan-01 00:00 scenarios/scenario_descriptions/form_filling_scenario.py
+-rw-r--r--  2.0 unx    10582 b- defN 80-Jan-01 00:00 scenarios/scenario_descriptions/form_filling_scenario.py
 -rw-r--r--  2.0 unx      370 b- defN 80-Jan-01 00:00 scenarios/scenario_descriptions/scenarios_description.py
 -rw-r--r--  2.0 unx        0 b- defN 80-Jan-01 00:00 scenarios/scenario_descriptions/tree_scenario/__init__.py
--rw-r--r--  2.0 unx     8800 b- defN 80-Jan-01 00:00 scenarios/scenario_descriptions/tree_scenario/tree_scenario.py
+-rw-r--r--  2.0 unx     8812 b- defN 80-Jan-01 00:00 scenarios/scenario_descriptions/tree_scenario/tree_scenario.py
 -rw-r--r--  2.0 unx      758 b- defN 80-Jan-01 00:00 scenarios/scenario_descriptions/tree_scenario/tree_scenario_node.py
 -rw-r--r--  2.0 unx        0 b- defN 80-Jan-01 00:00 scenarios/scenario_models/__init__.py
 -rw-r--r--  2.0 unx        0 b- defN 80-Jan-01 00:00 scenarios/scenario_models/field/__init__.py
 -rw-r--r--  2.0 unx     1731 b- defN 80-Jan-01 00:00 scenarios/scenario_models/field/composite_field.py
--rw-r--r--  2.0 unx     4764 b- defN 80-Jan-01 00:00 scenarios/scenario_models/field/composite_fillers.py
+-rw-r--r--  2.0 unx     4686 b- defN 80-Jan-01 00:00 scenarios/scenario_models/field/composite_fillers.py
 -rw-r--r--  2.0 unx      397 b- defN 80-Jan-01 00:00 scenarios/scenario_models/field/external_field_filler_descriptions.py
 -rw-r--r--  2.0 unx     4791 b- defN 80-Jan-01 00:00 scenarios/scenario_models/field/field.py
 -rw-r--r--  2.0 unx        0 b- defN 80-Jan-01 00:00 scenarios/scenario_models/field/field_descriptions/__init__.py
 -rw-r--r--  2.0 unx     2213 b- defN 80-Jan-01 00:00 scenarios/scenario_models/field/field_descriptions/basic_field_description.py
 -rw-r--r--  2.0 unx      715 b- defN 80-Jan-01 00:00 scenarios/scenario_models/field/field_descriptions/composite_field_description.py
 -rw-r--r--  2.0 unx      346 b- defN 80-Jan-01 00:00 scenarios/scenario_models/field/field_descriptions/integration_field_description.py
 -rw-r--r--  2.0 unx      777 b- defN 80-Jan-01 00:00 scenarios/scenario_models/field/field_descriptions/question_field_description.py
--rw-r--r--  2.0 unx    25864 b- defN 80-Jan-01 00:00 scenarios/scenario_models/field/field_filler_description.py
+-rw-r--r--  2.0 unx    26135 b- defN 80-Jan-01 00:00 scenarios/scenario_models/field/field_filler_description.py
 -rw-r--r--  2.0 unx      594 b- defN 80-Jan-01 00:00 scenarios/scenario_models/field/fields.py
 -rw-r--r--  2.0 unx        0 b- defN 80-Jan-01 00:00 scenarios/scenario_models/field_requirements/__init__.py
 -rw-r--r--  2.0 unx     4208 b- defN 80-Jan-01 00:00 scenarios/scenario_models/field_requirements/field_requirements.py
 -rw-r--r--  2.0 unx        0 b- defN 80-Jan-01 00:00 scenarios/scenario_models/field_validator/__init__.py
 -rw-r--r--  2.0 unx      655 b- defN 80-Jan-01 00:00 scenarios/scenario_models/field_validator/field_validator.py
 -rw-r--r--  2.0 unx        0 b- defN 80-Jan-01 00:00 scenarios/scenario_models/forms/__init__.py
 -rw-r--r--  2.0 unx     1079 b- defN 80-Jan-01 00:00 scenarios/scenario_models/forms/composite_forms.py
@@ -232,23 +232,23 @@
 -rw-r--r--  2.0 unx     7748 b- defN 80-Jan-01 00:00 smart_kit/management/tests.py
 -rw-r--r--  2.0 unx        0 b- defN 80-Jan-01 00:00 smart_kit/message/__init__.py
 -rw-r--r--  2.0 unx      765 b- defN 80-Jan-01 00:00 smart_kit/message/app_info.py
 -rw-r--r--  2.0 unx      398 b- defN 80-Jan-01 00:00 smart_kit/message/as_is_to_message.py
 -rw-r--r--  2.0 unx      259 b- defN 80-Jan-01 00:00 smart_kit/message/get_to_message.py
 -rw-r--r--  2.0 unx     3105 b- defN 80-Jan-01 00:00 smart_kit/message/smartapp_to_message.py
 -rw-r--r--  2.0 unx        0 b- defN 80-Jan-01 00:00 smart_kit/models/__init__.py
--rw-r--r--  2.0 unx     3363 b- defN 80-Jan-01 00:00 smart_kit/models/dialogue_manager.py
+-rw-r--r--  2.0 unx     3369 b- defN 80-Jan-01 00:00 smart_kit/models/dialogue_manager.py
 -rw-r--r--  2.0 unx     5280 b- defN 80-Jan-01 00:00 smart_kit/models/smartapp_model.py
 -rw-r--r--  2.0 unx        0 b- defN 80-Jan-01 00:00 smart_kit/names/__init__.py
 -rw-r--r--  2.0 unx      144 b- defN 80-Jan-01 00:00 smart_kit/names/action_params_names.py
 -rw-r--r--  2.0 unx      124 b- defN 80-Jan-01 00:00 smart_kit/names/field.py
 -rw-r--r--  2.0 unx      360 b- defN 80-Jan-01 00:00 smart_kit/names/message_names.py
 -rw-r--r--  2.0 unx        0 b- defN 80-Jan-01 00:00 smart_kit/request/__init__.py
 -rw-r--r--  2.0 unx     1394 b- defN 80-Jan-01 00:00 smart_kit/request/kafka_request.py
--rw-r--r--  2.0 unx    24496 b- defN 80-Jan-01 00:00 smart_kit/resources/__init__.py
+-rw-r--r--  2.0 unx    24642 b- defN 80-Jan-01 00:00 smart_kit/resources/__init__.py
 -rw-r--r--  2.0 unx        0 b- defN 80-Jan-01 00:00 smart_kit/start_points/__init__.py
 -rw-r--r--  2.0 unx     1198 b- defN 80-Jan-01 00:00 smart_kit/start_points/app.py
 -rw-r--r--  2.0 unx     6735 b- defN 80-Jan-01 00:00 smart_kit/start_points/base_main_loop.py
 -rw-r--r--  2.0 unx       56 b- defN 80-Jan-01 00:00 smart_kit/start_points/constants.py
 -rw-r--r--  2.0 unx     7976 b- defN 80-Jan-01 00:00 smart_kit/start_points/main_loop_async_http.py
 -rw-r--r--  2.0 unx     7147 b- defN 80-Jan-01 00:00 smart_kit/start_points/main_loop_http.py
 -rw-r--r--  2.0 unx    36715 b- defN 80-Jan-01 00:00 smart_kit/start_points/main_loop_kafka.py
@@ -326,11 +326,11 @@
 -rw-r--r--  2.0 unx     1325 b- defN 80-Jan-01 00:00 smart_kit/utils/cache.py
 -rw-r--r--  2.0 unx     2899 b- defN 80-Jan-01 00:00 smart_kit/utils/diff.py
 -rw-r--r--  2.0 unx        0 b- defN 80-Jan-01 00:00 smart_kit/utils/logger_writer/__init__.py
 -rw-r--r--  2.0 unx     3385 b- defN 80-Jan-01 00:00 smart_kit/utils/logger_writer/logger_formatter.py
 -rw-r--r--  2.0 unx        0 b- defN 80-Jan-01 00:00 smart_kit/utils/monitoring.py
 -rw-r--r--  2.0 unx      332 b- defN 80-Jan-01 00:00 smart_kit/utils/object_location.py
 -rw-r--r--  2.0 unx      320 b- defN 80-Jan-01 00:00 smart_kit/utils/picklable_mock.py
--rw-r--r--  2.0 unx    10823 b- defN 80-Jan-01 00:00 smart_app_framework-2.1.1rc1.dist-info/METADATA
--rw-r--r--  2.0 unx       88 b- defN 80-Jan-01 00:00 smart_app_framework-2.1.1rc1.dist-info/WHEEL
-?rw-r--r--  2.0 unx    32375 b- defN 16-Jan-01 00:00 smart_app_framework-2.1.1rc1.dist-info/RECORD
-334 files, 986134 bytes uncompressed, 253822 bytes compressed:  74.3%
+-rw-r--r--  2.0 unx    10823 b- defN 80-Jan-01 00:00 smart_app_framework-2.1.1rc2.dist-info/METADATA
+-rw-r--r--  2.0 unx       88 b- defN 80-Jan-01 00:00 smart_app_framework-2.1.1rc2.dist-info/WHEEL
+?rw-r--r--  2.0 unx    32375 b- defN 16-Jan-01 00:00 smart_app_framework-2.1.1rc2.dist-info/RECORD
+334 files, 986355 bytes uncompressed, 253931 bytes compressed:  74.3%
```

## zipnote {}

```diff
@@ -987,17 +987,17 @@
 
 Filename: smart_kit/utils/object_location.py
 Comment: 
 
 Filename: smart_kit/utils/picklable_mock.py
 Comment: 
 
-Filename: smart_app_framework-2.1.1rc1.dist-info/METADATA
+Filename: smart_app_framework-2.1.1rc2.dist-info/METADATA
 Comment: 
 
-Filename: smart_app_framework-2.1.1rc1.dist-info/WHEEL
+Filename: smart_app_framework-2.1.1rc2.dist-info/WHEEL
 Comment: 
 
-Filename: smart_app_framework-2.1.1rc1.dist-info/RECORD
+Filename: smart_app_framework-2.1.1rc2.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## core/message/from_message.py

```diff
@@ -64,18 +64,15 @@
             raise LookupError(f"{self.__class__.__name__} no incoming headers.")
         self.headers = Headers(headers or {})
         self._callback_id = None  # FIXME: by some reason it possibly to change callback_id
         self.masking_fields = masking_fields
         self.validators = validators
 
     def validate(self) -> bool:
-        """
-            Try to json.load message and check for all required fields
-        """
-
+        """Try to json.load message and check for all required fields"""
         for validator in self.validators:
             if not validator.validate(self.message_name, self.payload):
                 return False
 
         if self._headers_required and not self.headers:
             log("Message headers is empty", level="ERROR")
             return False
```

## scenarios/scenario_descriptions/form_filling_scenario.py

```diff
@@ -31,27 +31,27 @@
         return self._check_field(text_preprocessing_result, user, None)
 
     def check_ask_again_requests(self, text_preprocessing_result, user, params):
         form = user.forms[self.form_type]
         question_field = self._field(form, text_preprocessing_result, user, params)
         return question_field.ask_again_counter < len(question_field.description.ask_again_requests)
 
-    def ask_again(self, text_preprocessing_result, user, params):
+    async def ask_again(self, text_preprocessing_result, user, params):
         form = user.forms[self.form_type]
         question_field = self._field(form, text_preprocessing_result, user, params)
         question = question_field.description.ask_again_requests[question_field.ask_again_counter]
         question_field.ask_again_counter += 1
 
         user.history.add_event(
             Event(type=HistoryConstants.types.FIELD_EVENT,
                   scenario=self.root_id,
                   content={HistoryConstants.content_fields.FIELD: question_field.description.id},
                   result=HistoryConstants.event_results.ASK_QUESTION))
 
-        return question.run(user, text_preprocessing_result, params)
+        return await question.run(user, text_preprocessing_result, params)
 
     def _check_field(self, text_preprocessing_result, user, params):
         form = user.forms[self.form_type]
         field = self._field(form, text_preprocessing_result, user, params)
         return field.check_can_be_filled(text_preprocessing_result, user) if field else False
 
     def _field(self, form, text_preprocessing_result, user, params):
@@ -90,15 +90,14 @@
                           content={HistoryConstants.content_fields.FIELD: field_key},
                           result=HistoryConstants.event_results.FILLED)
             user.history.add_event(event)
         return result
 
     def _extract_data(self, form, text_normalization_result, user, params):
         result = {}
-
         callback_id = user.message.callback_id
         action_params = user.behaviors.get_callback_action_params(callback_id) or {}
         request_field = action_params.get(REQUEST_FIELD)
         if request_field and request_field["type"] == "integration":
             field = form.fields[request_field["id"]]
             field_descr = form.description.fields[request_field["id"]]
             if field.available:
@@ -109,34 +108,29 @@
             for field_key, field_descr in form.description.fields.items():
                 field = form.fields[field_key]
                 if field.available and isinstance(field, QuestionField):
                     result.update(self._extract_by_field_filler(field_key, field_descr,
                                                                 text_normalization_result, user, params))
         return result
 
-    def _validate_extracted_data(self,
-                                 user,
-                                 text_preprocessing_result,
-                                 form,
-                                 data_extracted,
-                                 params) -> List[Command]:
+    async def _validate_extracted_data(self, user, text_preprocessing_result, form,
+                                       data_extracted, params) -> List[Command]:
         error_msgs = []
         for field_key, field in form.description.fields.items():
             value = data_extracted.get(field_key)
             # is not None is necessary, because 0 and False should be checked, None - shouldn't fill
-            if value is not None and \
-                    not field.field_validator.requirement.check(value, params):
+            if value is not None and not field.field_validator.requirement.check(value, params):
                 log_params = {
                     log_const.KEY_NAME: log_const.SCENARIO_RESULT_VALUE,
                     "field_key": field_key
                 }
                 message = "Field is not valid: %(field_key)s"
                 log(message, user, log_params)
                 actions = field.field_validator.actions
-                error_msgs = self.get_action_results(user, text_preprocessing_result, actions)
+                error_msgs = await self.get_action_results(user, text_preprocessing_result, actions)
                 break
         return error_msgs
 
     async def _fill_form(self, user, text_preprocessing_result, form, data_extracted) -> Tuple[List[Command], bool]:
         on_filled_actions = []
         fields = form.fields
         scenario_model = user.scenario_models[self.id]
@@ -187,16 +181,16 @@
         user.preprocessing_messages_for_scenarios.add(text_preprocessing_result)
 
         data_extracted = self._extract_data(form, text_preprocessing_result, user, params)
         logging_params = {"data_extracted_str": str(data_extracted)}
         logging_params.update(self._log_params())
         log("Extracted data=%(data_extracted_str)s", user, logging_params)
 
-        validation_error_msg = self._validate_extracted_data(user, text_preprocessing_result,
-                                                             form, data_extracted, params)
+        validation_error_msg = await self._validate_extracted_data(user, text_preprocessing_result,
+                                                                   form, data_extracted, params)
         if validation_error_msg:
             reply_messages = validation_error_msg
         else:
             reply_messages, is_break = await self._fill_form(user, text_preprocessing_result, form, data_extracted)
             if not is_break:
                 field = self._field(form, text_preprocessing_result, user, params)
                 if field:
```

## scenarios/scenario_descriptions/tree_scenario/tree_scenario.py

```diff
@@ -120,16 +120,16 @@
                         log_params["field_key"] = field_key
                         log_params["extracted"] = extracted
                         log("message id: %(message_id)s, extracted data for field %(field_key)s: "
                             "%(extracted)s", user, log_params)
                     if extracted is not None and fill_other:
                         fill_other = fill_other and field_descr.fill_other
                         field_data = {field_key: extracted}
-                        _validation_error_msg = self._validate_extracted_data(user, text_preprocessing_result,
-                                                                              internal_form, field_data, params)
+                        _validation_error_msg = await self._validate_extracted_data(user, text_preprocessing_result,
+                                                                                    internal_form, field_data, params)
                         if _validation_error_msg:
                             # return only first validation message in form
                             validation_error_msg = validation_error_msg or _validation_error_msg
                         else:
                             data_extracted.update(field_data)
             on_filled_node_actions, is_break = await self._fill_form(user, text_preprocessing_result,
                                                                      internal_form, data_extracted)
```

## scenarios/scenario_models/field/composite_fillers.py

```diff
@@ -1,105 +1,118 @@
 from typing import Optional, Union, List, Dict, Any
 
-import core.logging.logger_constants as log_const
-from core.basic_models.actions.basic_actions import RequirementAction, ChoiceAction, ElseAction
-from core.logging.logger_utils import log
+from core.basic_models.requirement.basic_requirements import Requirement
 from core.model.factory import factory, list_factory
 from core.text_preprocessing.base import BaseTextPreprocessingResult
 from core.utils.exception_handlers import exc_handler
 from scenarios.scenario_models.field.field_filler_description import FieldFillerDescription
 from scenarios.user.user_model import User
 
 
-class RequirementFiller(RequirementAction):
+class RequirementFiller(FieldFillerDescription):
+    requirement: Requirement
+    internal_item: FieldFillerDescription
+
     FIELD_KEY = "filler"
 
     def __init__(self, items: Dict[str, Any], id: Optional[str] = None):
-        super(RequirementFiller, self).__init__(items, id)
+        super().__init__(items, id)
+        self._requirement: str = items["requirement"]
+        # can be used not only with filters but with every entity which implements FieldFillerDescription interface
+        # to not change statics "item" key is added
+        self._item: str = items[self.FIELD_KEY]
+
+        self.requirement = self.build_requirement()
         self.internal_item = self.build_internal_item()
 
+    @factory(Requirement)
+    def build_requirement(self) -> str:
+        return self._requirement
+
     @factory(FieldFillerDescription)
-    def build_internal_item(self):
+    def build_internal_item(self) -> str:
         return self._item
 
-    def on_extract_error(self, text_preprocessing_result, user, params=None):
-        log("exc_handler: RequirementFiller failed to extract. Return None. MESSAGE: %(masked_message)s.",
-            user, {log_const.KEY_NAME: log_const.HANDLED_EXCEPTION_VALUE, "masked_message": user.message.masked_value},
-            level="ERROR", exc_info=True)
-        return None
-
     @exc_handler(on_error_obj_method_name="on_extract_error")
     def extract(self, text_preprocessing_result: BaseTextPreprocessingResult,
                 user: User, params: Dict[str, Any] = None) -> Optional[Union[int, float, str, bool, List, Dict]]:
         if self.requirement.check(text_preprocessing_result, user, params):
             return self.internal_item.run(user, text_preprocessing_result, params)
 
 
-class ChoiceFiller(ChoiceAction):
+class ChoiceFiller(FieldFillerDescription):
+    items: List[RequirementFiller]
+    else_item: Optional[FieldFillerDescription]
+
     FIELD_REQUIREMENT_KEY = "requirement_fillers"
     FIELD_ELSE_KEY = "else_filler"
 
     def __init__(self, items: Dict[str, Any], id: Optional[str] = None):
-        super(ChoiceFiller, self).__init__(items, id)
-        self._requirement_items = items[self.FIELD_REQUIREMENT_KEY]
-        self._else_item = items.get(self.FIELD_ELSE_KEY)
+        super().__init__(items, id)
+        self._requirement_items: List[str] = items[self.FIELD_REQUIREMENT_KEY]
+        self._else_item: Optional[str] = items.get(self.FIELD_ELSE_KEY)
 
         self.items = self.build_items()
-        self.else_item = self.build_else_item()
+
+        if self._else_item:
+            self.else_item = self.build_else_item()
+        else:
+            self.else_item = None
 
     @list_factory(RequirementFiller)
-    def build_items(self):
+    def build_items(self) -> List[str]:
         return self._requirement_items
 
     @factory(FieldFillerDescription)
-    def build_else_item(self):
+    def build_else_item(self) -> Optional[str]:
         return self._else_item
 
-    def on_extract_error(self, text_preprocessing_result, user, params=None):
-        log("exc_handler: ChoiceFiller failed to extract. Return None. MESSAGE: %(masked_message)s.",
-            user, {log_const.KEY_NAME: log_const.HANDLED_EXCEPTION_VALUE, "masked_message": user.message.masked_value},
-            level="ERROR", exc_info=True)
-        return None
-
     @exc_handler(on_error_obj_method_name="on_extract_error")
     def extract(self, text_preprocessing_result: BaseTextPreprocessingResult,
                 user: User, params: Dict[str, Any] = None) -> Optional[Union[int, float, str, bool, List, Dict]]:
         for item in self.items:
             if item.requirement.check(text_preprocessing_result, user, params):
                 return item.internal_item.run(user, text_preprocessing_result, params)
         if self._else_item:
             return self.else_item.run(user, text_preprocessing_result, params)
 
 
-class ElseFiller(ElseAction):
+class ElseFiller(FieldFillerDescription):
+    requirement: Requirement
+    item: RequirementFiller
+    else_item: Optional[FieldFillerDescription]
+
     FIELD_ITEM_KEY = "filler"
     FIELD_ELSE_KEY = "else_filler"
 
     def __init__(self, items: Dict[str, Any], id: Optional[str] = None):
-        super(ElseFiller, self).__init__(items, id)
-        self._item = items[self.FIELD_ITEM_KEY]
-        self._else_item = items.get(self.FIELD_ELSE_KEY)
+        super().__init__(items, id)
+        self._requirement: str = items["requirement"]
+        self._item: str = items[self.FIELD_ITEM_KEY]
+        self._else_item: Optional[str] = items.get(self.FIELD_ELSE_KEY)
 
+        self.requirement = self.build_requirement()
         self.item = self.build_item()
-        self.else_item = self.build_else_item()
+        if self._else_item:
+            self.else_item = self.build_else_item()
+        else:
+            self.else_item = None
+
+    @factory(Requirement)
+    def build_requirement(self) -> str:
+        return self._requirement
 
     @factory(FieldFillerDescription)
-    def build_item(self):
+    def build_item(self) -> str:
         return self._item
 
     @factory(FieldFillerDescription)
-    def build_else_item(self):
+    def build_else_item(self) -> Optional[str]:
         return self._else_item
 
-    def on_extract_error(self, text_preprocessing_result, user, params=None):
-        log("exc_handler: ElseFiller failed to extract. Return None. MESSAGE: %(masked_message)s.",
-            user, {log_const.KEY_NAME: log_const.HANDLED_EXCEPTION_VALUE, "masked_message": user.message.masked_value},
-            level="ERROR", exc_info=True)
-        return None
-
     @exc_handler(on_error_obj_method_name="on_extract_error")
     def extract(self, text_preprocessing_result: BaseTextPreprocessingResult,
                 user: User, params: Dict[str, Any] = None) -> Optional[Union[int, float, str, bool, List, Dict]]:
         if self.requirement.check(text_preprocessing_result, user, params):
             return self.item.run(user, text_preprocessing_result, params)
         elif self._else_item:
             return self.else_item.run(user, text_preprocessing_result, params)
```

## scenarios/scenario_models/field/field_filler_description.py

```diff
@@ -28,14 +28,17 @@
 
 field_filler_description = Registered()
 
 field_filler_factory = build_factory(field_filler_description)
 
 
 class FieldFillerDescription:
+    """Базовый класс для filler'ов, содержайщий логику извлечения сущностей из текущего состояния смартапа"""
+    version: Optional[int]
+    id: Optional[str]
 
     def __init__(self, items: Dict[str, Any], id: Optional[str] = None) -> None:
         items = items or {}
         self.id = id
         self.version = items.get("version", -1)
 
     def _log_params(self):
@@ -45,15 +48,16 @@
         }
 
     def extract(self, text_preprocessing_result: BaseTextPreprocessingResult, user: User,
                 params: Dict[str, Any] = None) -> None:
         return None
 
     def on_extract_error(self, text_preprocessing_result, user, params=None):
-        log("exc_handler: Filler failed to extract. Return None. MESSAGE: %(masked_message)s.", user,
+        log(f"exc_handler: {self.__class__.__name__} failed to extract. Return None. MESSAGE: %(masked_message)s.",
+            user,
             {log_const.KEY_NAME: core_log_const.HANDLED_EXCEPTION_VALUE, "masked_message": user.message.masked_value},
             level="ERROR", exc_info=True)
         return None
 
     def run(self, user: User, text_preprocessing_result: BaseTextPreprocessingResult,
             params: Optional[Dict[str, Any]] = None) -> None:
         return self.extract(text_preprocessing_result, user, params)
```

## smart_kit/models/dialogue_manager.py

```diff
@@ -38,15 +38,15 @@
         if scenario_key in scenarios_names:
             scenario = self.scenarios[scenario_key]
             is_form_filling = isinstance(scenario, FormFillingScenario)
             if is_form_filling:
                 if not scenario.text_fits(text_preprocessing_result, user):
                     params = user.parametrizer.collect(text_preprocessing_result)
                     if scenario.check_ask_again_requests(text_preprocessing_result, user, params):
-                        reply = scenario.ask_again(text_preprocessing_result, user, params)
+                        reply = await scenario.ask_again(text_preprocessing_result, user, params)
                         return reply, True
                     monitoring.counter_nothing_found(self.app_name, scenario_key, user)
                     return await self._nothing_found_action.run(user, text_preprocessing_result), False
         return await self.run_scenario(scenario_key, text_preprocessing_result, user), True
 
     async def run_scenario(self, scen_id, text_preprocessing_result, user):
         initial_last_scenario = user.last_scenarios.last_scenario_name
```

## smart_kit/resources/__init__.py

```diff
@@ -23,15 +23,16 @@
 from core.basic_models.actions.variable_actions import ClearVariablesAction, DeleteVariableAction, \
     SetLocalVariableAction, SetVariableAction
 from core.basic_models.answer_items.answer_items import items_factory, SdkAnswerItem, answer_items, BubbleText, \
     ItemCard, PronounceText, SuggestText, SuggestDeepLink, RawItem
 from core.basic_models.classifiers.basic_classifiers import classifiers, classifier_factory, Classifier, \
     ExternalClassifier, SciKitClassifier, SkipClassifier
 from core.basic_models.classifiers.external_classifiers import ExternalClassifiers
-from core.basic_models.requirement.basic_requirements import requirement_factory, IntersectionRequirement
+from core.basic_models.requirement.basic_requirements import requirement_factory, IntersectionRequirement, \
+    TopicRequirement, RollingRequirement
 from core.basic_models.requirement.basic_requirements import requirements, Requirement, AndRequirement, \
     OrRequirement, NotRequirement, TemplateRequirement, RandomRequirement, TimeRequirement, DateTimeRequirement, \
     ClassifierRequirement, FormFieldValueRequirement, EnvironmentRequirement, CharacterIdRequirement, \
     FeatureToggleRequirement
 from core.basic_models.requirement.counter_requirements import CounterValueRequirement, CounterUpdateTimeRequirement
 from core.basic_models.requirement.device_requirements import ChannelRequirement
 from core.basic_models.requirement.external_requirements import ExternalRequirement
@@ -345,19 +346,21 @@
         requirements["num_in_range"] = NumInRangeRequirement
         requirements["or"] = OrRequirement
         requirements["phone_number_number"] = PhoneNumberNumberRequirement
         requirements["platform_type"] = dr.PlatformTypeRequirement
         requirements["platform_version"] = dr.PlatformVersionRequirement
         requirements["random"] = RandomRequirement
         requirements["regexp_in_template"] = RegexpInTemplateRequirement
+        requirements["rolling"] = RollingRequirement
         requirements["surface"] = dr.SurfaceRequirement
         requirements["surface_version"] = dr.SurfaceVersionRequirement
         requirements["template"] = TemplateRequirement
         requirements["template_in_array"] = TemplateInArrayRequirement
         requirements["time"] = TimeRequirement
+        requirements["topic"] = TopicRequirement
         requirements["settings"] = SettingsRequirement
 
     def init_sdk_items(self):
         answer_items["bubble_text"] = BubbleText
         answer_items["item_card"] = ItemCard
         answer_items["pronounce_text"] = PronounceText
         answer_items["raw"] = RawItem
```

## Comparing `smart_app_framework-2.1.1rc1.dist-info/METADATA` & `smart_app_framework-2.1.1rc2.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: smart-app-framework
-Version: 2.1.1rc1
+Version: 2.1.1rc2
 Summary: Python-фреймворк, который позволяет создавать смартапы для виртуальных ассистентов Салют.
 Author: Salute Developers
 Author-email: developer@sberdevices.ru
 Requires-Python: >=3.8.1,<3.12
 Classifier: Operating System :: MacOS
 Classifier: Operating System :: POSIX :: Linux
 Classifier: Programming Language :: Python :: 3
```

## Comparing `smart_app_framework-2.1.1rc1.dist-info/RECORD` & `smart_app_framework-2.1.1rc2.dist-info/RECORD`

 * *Files 1% similar despite different names*

```diff
@@ -61,15 +61,15 @@
 core/logging/logger_constants.py,sha256=hn56NJa4uT94uZ56W7nVFxV8rJp2fczrBHJLhh2XFPM,568
 core/logging/logger_formatter.py,sha256=3gBZq87MQIj2f45MF5AcsJNAoLJVM6aUYE7C2hd-6p0,937
 core/logging/logger_handlers.py,sha256=RWetoI6jCU7UUnZrxKol0kPxOLRaMSv-h0VhzUSC5y8,386
 core/logging/logger_utils.py,sha256=gwbCzCFmdtxj0RfKOXG4HfW--YOPttHWKf8GycFvBF8,5264
 core/message/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 core/message/app_info.py,sha256=N35Q5NIuwi7CADWt8DqLcg97h0IVt9Up6WhQhwmdeZ4,765
 core/message/device.py,sha256=u7XbFgDDx7n8vScd_KgMySt_ztrYnoRzwmfr4ukMOFo,1370
-core/message/from_message.py,sha256=E8LfHen15ffIWGIVuO1VT4M57p1PwAhJx1hNGQRNu2g,9260
+core/message/from_message.py,sha256=acy1FzQr8WdfOGXzkk-h-Ck1NmM1a5dKWjiFkbs579Q,9237
 core/message/message_constants.py,sha256=K_ZvW_IvW7bBDo5PrrWFBlfPGq9WJQuz5a4O9YWmEsc,120
 core/message/msg_validator.py,sha256=tFm5A9yTE5HoPntYPS5057c43viDuODNLryeL2mRzUI,179
 core/model/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 core/model/base_user.py,sha256=m2vtxxan7ow1JLo6BHIKsGsqXOUGR3WCztHyfNXJ10w,3159
 core/model/factory.py,sha256=7OlLQPmiEv0Gcaa13eahwN6WJ14hxii6tgRxUu--fNA,2817
 core/model/field.py,sha256=D2YvHG_9NnLS1uU5PaMPFUrFhypgv9FD1JfoAOk5fEw,209
 core/model/heapq/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
@@ -144,31 +144,31 @@
 scenarios/behaviors/behavior_descriptions.py,sha256=w2S96S87yQjbT29qGfRVqEwWQfqhyv0TmQc6b6j95sk,359
 scenarios/behaviors/behaviors.py,sha256=UdkHzh5poO6GuErUNjESNhpGf6wfDUN3F2LAgPBCrYI,15834
 scenarios/logging/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 scenarios/logging/logger_constants.py,sha256=1-8BDXuGVlm7zadXxbgYBtX-uqLN1iiWgxJYSBH1Wgk,4248
 scenarios/requirements/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 scenarios/requirements/requirements.py,sha256=V2PMggBuETJiCUKZghNQ2krkj4HR09qsUjvzrx_5tls,2799
 scenarios/scenario_descriptions/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-scenarios/scenario_descriptions/form_filling_scenario.py,sha256=zXAe7sqWdNufIfYQG8xPIWBAFVwHoDx_kY2ILglAioY,10695
+scenarios/scenario_descriptions/form_filling_scenario.py,sha256=iI4yhdsXHtyFRsKdxgvEY2GxlAA81agD2zk0I-VjxB4,10582
 scenarios/scenario_descriptions/scenarios_description.py,sha256=LuLDMzYE015rgdeCmk0ER9uyZ8QbirrVgPO8Ke_A-68,370
 scenarios/scenario_descriptions/tree_scenario/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-scenarios/scenario_descriptions/tree_scenario/tree_scenario.py,sha256=gp18Jga_c2HVKwh1AMnrFA4hIOl9u_QtBVKsB8lC0uc,8800
+scenarios/scenario_descriptions/tree_scenario/tree_scenario.py,sha256=FCo9FyeRuK8NtQV3r2YtZ5b7-AMLg4wZTlsxuBsf3E0,8812
 scenarios/scenario_descriptions/tree_scenario/tree_scenario_node.py,sha256=-063NR-dI8y5f1cqkxCwB0r9xVACYsEfuYVpre2_5Gg,758
 scenarios/scenario_models/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 scenarios/scenario_models/field/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 scenarios/scenario_models/field/composite_field.py,sha256=eC5pEcMJBwtDKtvgj6q7npKL7QnWVnse-HMOIXIVN0Y,1731
-scenarios/scenario_models/field/composite_fillers.py,sha256=YaRqdX13mZerBfzNtD6U0T0Jbki8ikqM53BXIwV4Jw0,4764
+scenarios/scenario_models/field/composite_fillers.py,sha256=OUlfYN7JoXlHlliNAQKuuaPCPUn7Yqy6Z890CmISYi0,4686
 scenarios/scenario_models/field/external_field_filler_descriptions.py,sha256=dK2DLd71KAbu4ifHYMQD02JJHP7jlmlS4_BRH1hffDE,397
 scenarios/scenario_models/field/field.py,sha256=jWUmSSmL6-Cr-ph_2cLB1CGy2DxW2JSbyBHe1S0Omss,4791
 scenarios/scenario_models/field/field_descriptions/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 scenarios/scenario_models/field/field_descriptions/basic_field_description.py,sha256=SVrB4caxyZ-7Xh1NvIDMFEAnyzDX93_tyCJLvDHSHzA,2213
 scenarios/scenario_models/field/field_descriptions/composite_field_description.py,sha256=VFNv9-O-ipCsS3k8WIfhqYKF1Zp09ot18EyG-FU3pZY,715
 scenarios/scenario_models/field/field_descriptions/integration_field_description.py,sha256=87Bis-TWcrtw4dZI4XHz5mY-cBb89Y5XAwapGasL070,346
 scenarios/scenario_models/field/field_descriptions/question_field_description.py,sha256=LyEBO1FNf7x4zAO08k1xQBFnsKqzWLOSgmg8jl1O3IA,777
-scenarios/scenario_models/field/field_filler_description.py,sha256=87Vs7GGcIXm2TxK9YWWQH24HliPuTap9OeWV2lgZxzg,25864
+scenarios/scenario_models/field/field_filler_description.py,sha256=vImRRa9qlqCo6SIr81DVKP6vPmpkpnxK8kiC0tm0wyo,26135
 scenarios/scenario_models/field/fields.py,sha256=-LRAhU60t75dsQacrtd32oZvTEg-5sC45gnFKd25Qiw,594
 scenarios/scenario_models/field_requirements/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 scenarios/scenario_models/field_requirements/field_requirements.py,sha256=-ymRULhSTDWx38dliC-_Jduoh4nHL_mo9y_BlFzXmoM,4208
 scenarios/scenario_models/field_validator/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 scenarios/scenario_models/field_validator/field_validator.py,sha256=HOXolOtc6AhXmS9ddKc-B-YHK786C5GVNh8nme1l14k,655
 scenarios/scenario_models/forms/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 scenarios/scenario_models/forms/composite_forms.py,sha256=4osUPoVO1iB4qgJK6U_yMumm7LkK1jyK1ALS47ot6EU,1079
@@ -231,23 +231,23 @@
 smart_kit/management/tests.py,sha256=wxubruqau-RfRXY6r7ZUH3oc7OFApHSQJm7YFbtg52g,7748
 smart_kit/message/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 smart_kit/message/app_info.py,sha256=N35Q5NIuwi7CADWt8DqLcg97h0IVt9Up6WhQhwmdeZ4,765
 smart_kit/message/as_is_to_message.py,sha256=Nf71Oeez8ZkJHjQwTJ31-X3doj8j2XmkBQ7l4pQBHMI,398
 smart_kit/message/get_to_message.py,sha256=UzQzD7Z3FO9HHJKUzYzaXtsddfVjKKDPdI_-VUU03KM,259
 smart_kit/message/smartapp_to_message.py,sha256=8Ec7F3LcTGYEngvqwXBMjSTq60E25S2iwtoz6lZjpbo,3105
 smart_kit/models/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-smart_kit/models/dialogue_manager.py,sha256=EBLR584n0MQ_uXaOApulj6xYSqyGDlc4kayS7CQGcGc,3363
+smart_kit/models/dialogue_manager.py,sha256=SbZ_et_yeD9Mw_OPDE6zIfITMAkpaPBWcrir6kMHNFE,3369
 smart_kit/models/smartapp_model.py,sha256=7iI3KlWd9qwYz5zR0lxS9BrAhJGqvIhnXYn3ZCSCTEs,5280
 smart_kit/names/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 smart_kit/names/action_params_names.py,sha256=6zLYlEBgeBL6SzCjeLAgojxUOUPcYl0-I77mUKU6av8,144
 smart_kit/names/field.py,sha256=H9A7y0yI03Mr2N9WHCTN6tJ38lm-xHWdCLI4fBDWwu0,124
 smart_kit/names/message_names.py,sha256=pJTk9uFLz8mnHB_PY0kGDjQ9vpWZYbJF24GKAAmD0Mc,360
 smart_kit/request/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 smart_kit/request/kafka_request.py,sha256=cWYtOOiqh7Yz3AVV6Y31_lRTDwYILRr3N4yfcns3T7w,1394
-smart_kit/resources/__init__.py,sha256=Mai7K65WYLowvKQ70RZwMUaSshnj4DZPKZvyZ4Yhzys,24496
+smart_kit/resources/__init__.py,sha256=wn2ybqp9FpcZB__W4XTDdbyuRoYRFihO_Lp-WQEPhJc,24642
 smart_kit/start_points/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 smart_kit/start_points/app.py,sha256=8lcZV7SiEBzFdcF7oe-54w7hmyHfK9PQ_IDa64_kVjM,1198
 smart_kit/start_points/base_main_loop.py,sha256=Kcedoy-rAhjk2HChcxb-sWY-XlE3ptMcB4VZT6HO6WY,6735
 smart_kit/start_points/constants.py,sha256=d_XQfL3YxYswZd5AFIwugqv8EimD18ZFfPRcPJpAgK0,56
 smart_kit/start_points/main_loop_async_http.py,sha256=o2tOOpkt-J0T3fJzS-cKVBqAEwEsmshWeACbudzzBfg,7976
 smart_kit/start_points/main_loop_http.py,sha256=TNNHuwrqbrg7fpLY1pY_J43dA2hbsNs-_MePOyqo_s8,7147
 smart_kit/start_points/main_loop_kafka.py,sha256=KNVMRXimJ4FY2cDMA06Y0Q6Prlba096S-Op9gU9dN4c,36715
@@ -325,10 +325,10 @@
 smart_kit/utils/cache.py,sha256=Lut5HMkfoeiRwCCnZoSHw7srWYn3Y0fD-hUJWckDBf8,1325
 smart_kit/utils/diff.py,sha256=rUdzi6f8mtXacNL6HvVYVoOnXD_M3FEMHFsMhPo0YL0,2899
 smart_kit/utils/logger_writer/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 smart_kit/utils/logger_writer/logger_formatter.py,sha256=bC7tdYW480irANhxaFxiKgnAsvmz-luf52WSu7ZjnIU,3385
 smart_kit/utils/monitoring.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 smart_kit/utils/object_location.py,sha256=uJmTxBBeeyvwahiA1TMKr2rzDW9R1bh-FwK663zoBe4,332
 smart_kit/utils/picklable_mock.py,sha256=PxrgnKue58GFpVZMBGIQq36LPnITFzfNA21euCbfViE,320
-smart_app_framework-2.1.1rc1.dist-info/METADATA,sha256=zTgsP0HpEs3wudTEq9i_PZGJ5nkX0T3Lf1NVzQ-BrkY,10823
-smart_app_framework-2.1.1rc1.dist-info/WHEEL,sha256=Zb28QaM1gQi8f4VCBhsUklF61CTlNYfs9YAZn-TOGFk,88
-smart_app_framework-2.1.1rc1.dist-info/RECORD,,
+smart_app_framework-2.1.1rc2.dist-info/METADATA,sha256=bXwqiK9SOi1aGkjRxB6E6zy3iGnRH1hr9L1q-olehXY,10823
+smart_app_framework-2.1.1rc2.dist-info/WHEEL,sha256=Zb28QaM1gQi8f4VCBhsUklF61CTlNYfs9YAZn-TOGFk,88
+smart_app_framework-2.1.1rc2.dist-info/RECORD,,
```

